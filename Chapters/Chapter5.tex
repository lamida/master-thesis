% Chapter 5

\chapter{Results} % Main chapter title

\label{Chapter5} % For referencing the chapter elsewhere, use~\ref{Chapter5} 

In this research we used the offline measurement generator in getting the
measurement across different real world programs. We calculate the ScaRR control
flow information for each of the programs and we analyse and present the result
in this chapter. The analysis and source code of the program is available in
this Github repository: \url{https://github.com/lamida/scarr-sample-program/}.

In this research we choose 4 large open source projects for analysis. We
download the source code and checkout the latest version of the code. The first
software is Redis $6.2.4$ ~\cite{RedisRedis2021}, a what so called data
structure server that is widely used in real world. The Redis source build
consist of the server binary and the client cli. We analyse both of the program.

The second program we analyse is bzip2 $1.08$~\cite{Bzip2Bzip2}. Bzip2 is free
and open source file compression program. The third program is openssl
$1.1.1j$~\cite{OpensslOpenssl2021}. OpenSSL is full-featured toolkit for TLS
protocol. 

The last suite program we analyse is coreutils
$8.32$~\cite{CoreutilsCoreutils2021}. Coreutils is suite of Unix utilities for
file, shell and text manipulation.

For each of program, we are collecting the following measurements:

\begin{itemize}
    \item source code lines
    \item IR lines
    \item number of basic blocks (nBB)
    \item number of ScaRR measurements (nM)
    \item number of checkpoints (nCP)
    \item number of LoA (nLoA)
\end{itemize}

However, before going to result the next section will show how to run the pass.

\section{Running The Pass}

To mark the list of Checkpoints, we can invoke LLVM \texttt{opt} as shown in
listing~\ref{listing:mark-cp-in-cfg}.

\begin{listing}[ht]
    \begin{minted}[
        frame=lines,
        framesep=2mm,
        baselinestretch=1.2,
        fontsize=\footnotesize,
    ]{bash}
        opt -passes=scarr-cp-marker <file>.ll
    \end{minted}
    \caption{Mark Checkpoint in BasicBlock.}    
    \label{listing:mark-cp-in-cfg}
\end{listing}

We can see the basic blocks output that has been marked with checkpoint using
LLVM dot-cfg pass.

\begin{listing}[ht]
    \begin{minted}[
        frame=lines,
        framesep=2mm,
        baselinestretch=1.2,
        fontsize=\footnotesize,
    ]{bash}
        opt -passes=scarr-cp-marker,dot-cfg <file>.ll
    \end{minted}
    \caption{Print Checkpoints in CFG dot file.}    
    \label{listing:cp-to-cfg}
\end{listing}

The commands in listing~\ref{listing:cp-to-cfg} generates different dot files
per function. We can use xdot command line from graphiz to see the graph. 

To mark the list of actions between checkpoints, we can invoke LLVM \texttt{opt}
as shown in Listing~\ref{listing:get-loa}

\begin{listing}[ht]
    \begin{minted}[
        frame=lines,
        framesep=2mm,
        baselinestretch=1.2,
        fontsize=\footnotesize,
    ]{c++}
        opt -passes=scarr-cp-marker,scarr-loa-collector <file>.ll
    \end{minted}
    \caption{Get List of Actions}    
    \label{listing:get-loa}
\end{listing}

Note that we have to run scarr-cp-marker before scarr-loa-collector.

The result and its interpretation are discussed in the next chapter.

\section{ScaRR Control Flow Result}



\begin{table}[t]
	\centering
	\begin{tabular}{lrrrrrr}
		\toprule 
		
		\multirow{2}{*}{Use case} &
		\multirow{2}{*}{\# functions} & 
		\multicolumn{2}{c}{\emph{action}} & 
		\multicolumn{2}{c}{edge} & 
		\multicolumn{1}{c}{\% \emph{action}} \\ 
		
		& & \multicolumn{1}{c}{$\mu$} & \multicolumn{1}{c}{$\sigma$} & 
		\multicolumn{1}{c}{$\mu$} & \multicolumn{1}{c}{$\sigma$} & 
		\multicolumn{1}{c}{explored} \\
		
		\midrule	
		\textsf{Contact} & $71$ & $12.77$ & $12.59$ & $15.09$ 
		& 
		$17.64$ & $96.4\%$ \\
		\textsf{libdvdcss} & $47$ & $25.40$ & $22.05$ & 
		$34.44$ 
		& $31.50$ & $92.8\%$ \\
		\textsf{StealthDB} & $44$ & $18.29$ & $13.53$ & 
		$21.97$ & $18.05$ & $96.6\%$ \\
		\textsf{SGX-Biniax2} & $49$ & $8.55$ & 
		$8.75$ & $9.29$ & $11.71$ & $91.6\%$ \\
		\textsf{Unit-test} & $17$ & $6.88$ & $7.47$ & $7.17$ & $10.52$ & 
		$94.0\%$ \\ 
		\midrule
		\emph{total} & $228$ & - & - & - & - & - \\ 
		\bottomrule
	\end{tabular} 
	\caption{\ft{this is a style example. Important things: no vertical 
	lines, numbers right aligned, keep a consistent number of decimal place (at 
	least per column), no horizontal lines besides top, bottom, and a few 
	middle after the header. 
	Extra point 1, for very long table pls consider to use alternative row 
	colors 
	https://tex.stackexchange.com/questions/5363/how-to-create-alternating-rows-in-a-table
	 . Extra point 2, to span a table over multiple pages check this 
	https://tex.stackexchange.com/questions/26462/make-a-table-span-multiple-pages
	 }}
	\label{tbl:example}
\end{table}

\xt{Elaborate the results, add charts for better visualization than just table.}
\xt{TODO: remove this long table and use simpler visualization}

\csvautolongtable{csv/coreutils.csv}
\xt{Find a way to add caption to this long table}

\begin{table}[hbtp]
    \centering
    \csvautotabular{csv/redis.csv}
    \caption{Redis ScaRR measurements.}
\end{table}

\begin{table}[hbtp]
    \centering
    \csvautotabular{csv/misc.csv}
    \caption{Some additional programs ScaRR measurements.}
\end{table}

\section{Complexity Analysis}

TBD

\section{Case Study}

TBD